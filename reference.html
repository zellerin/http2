<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml' xml:lang='en' lang='en'>
<head>
<title>More detailed API documentation
</title>
<link type='text/css' href='style.css' rel='stylesheet'>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=device-width">
   <script src="jquery.min.js"></script>
<script src="toc.min.js"></script>
<script type="text/x-mathjax-config">
     MathJax.Hub.Config({
       tex2jax: {
         inlineMath: [['$','$']],
         processEscapes: true
       }
     });
   </script>
   <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
   </script>
   
</head>
<body>
<div id="content-container">
<div id="toc">
<div id="page-toc">
</div>
<div id="toc-footer"><ul><li><a href="https://github.com/melisgl/mgl-pax">[generated by MGL-PAX]</a></li></ul></div>
</div>
<div id="content">
<p><a id="x-28HTTP2-3A-40REFERENCE-20MGL-PAX-3ASECTION-29"></a>
<a id="HTTP2:@REFERENCE%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="tutorials.html#HTTP2%2FCLIENT:@CUSTOMIZING-CLIENT-REFERENCE%20MGL-PAX:SECTION" title="Client reference">&#8592;</a> <a href="index.html" title="`HTTP2` in Common Lisp">&#8593;</a> <a href="#HTTP2%2FSERVER:@SERVER-REFERENCE%20MGL-PAX:SECTION" title="Server API reference">&#8594;</a> <a href="reference.html" title="More detailed API documentation">&#8634;</a> <a href="https://github.com/zellerin/http2/blob/master/overview.lisp#L27">&#955;</a></span></span></p>
<h2><a href="reference.html">3 More detailed API documentation</a></h2>
<p><a id="x-28HTTP2-2FSERVER-3A-40SERVER-REFERENCE-20MGL-PAX-3ASECTION-29"></a>
<a id="HTTP2%2FSERVER:@SERVER-REFERENCE%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="reference.html" title="More detailed API documentation">&#8592;</a> <a href="reference.html" title="More detailed API documentation">&#8593;</a> <a href="#HTTP2%2FSERVER:@ASYNC-SERVER%20MGL-PAX:SECTION" title="Polling server">&#8594;</a> <a href="#HTTP2%2FSERVER:@SERVER-REFERENCE%20MGL-PAX:SECTION" title="Server API reference">&#8634;</a> <a href="https://github.com/zellerin/http2/blob/master/server/dispatch.lisp#L381">&#955;</a></span></span></p>
<h3><a href="#HTTP2%2FSERVER:@SERVER-REFERENCE%20MGL-PAX:SECTION">3.1 Server API reference</a></h3>
<h6>[in package HTTP2/SERVER with nicknames HTTP2/SERVER/SHARED, HTTP2/SERVER/POLL, HTTP2/SERVER/THREADED]</h6>
<p><a id="x-28HTTP2-2FSERVER-3A-2AVANILLA-SERVER-DISPATCHER-2A-20VARIABLE-29"></a>
<a id="HTTP2%2FSERVER:*VANILLA-SERVER-DISPATCHER*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/zellerin/http2/blob/master/server/socket-dispatcher.lisp#L43">[variable]</a></span> <span class="reference-object"><a href="#HTTP2%2FSERVER:*VANILLA-SERVER-DISPATCHER*%20VARIABLE" >*VANILLA-SERVER-DISPATCHER*</a></span></span> <span class="locative-args">NIL</span></span></p>

<p>Default value of the server dispatcher. One of <a href="#HTTP2%2FSERVER:DETACHED-TLS-THREADED-DISPATCHER%20CLASS" title="HTTP2/SERVER:DETACHED-TLS-THREADED-DISPATCHER CLASS"><code>DETACHED-TLS-THREADED-DISPATCHER</code></a>
ot <a href="#HTTP2%2FSERVER:POLL-DISPATCHER%20CLASS" title="HTTP2/SERVER:POLL-DISPATCHER CLASS"><code>POLL-DISPATCHER</code></a></p></li>
</ul>
<p><a id="x-28HTTP2-2FSERVER-3ATLS-SINGLE-CLIENT-DISPATCHER-20CLASS-29"></a>
<a id="HTTP2%2FSERVER:TLS-SINGLE-CLIENT-DISPATCHER%20CLASS"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/zellerin/http2/blob/master/server/dispatch.lisp#L322">[class]</a></span> <span class="reference-object"><a href="#HTTP2%2FSERVER:TLS-SINGLE-CLIENT-DISPATCHER%20CLASS" >TLS-SINGLE-CLIENT-DISPATCHER</a></span></span> <span class="locative-args">TLS-DISPATCHER-MIXIN SINGLE-CLIENT-DISPATCHER</span></span></li>
</ul>
<p><a id="x-28HTTP2-2FSERVER-3ADETACHED-TLS-SINGLE-CLIENT-DISPATCHER-20CLASS-29"></a>
<a id="HTTP2%2FSERVER:DETACHED-TLS-SINGLE-CLIENT-DISPATCHER%20CLASS"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/zellerin/http2/blob/master/server/dispatch.lisp#L325">[class]</a></span> <span class="reference-object"><a href="#HTTP2%2FSERVER:DETACHED-TLS-SINGLE-CLIENT-DISPATCHER%20CLASS" >DETACHED-TLS-SINGLE-CLIENT-DISPATCHER</a></span></span> <span class="locative-args"><a href="#HTTP2%2FSERVER:TLS-SINGLE-CLIENT-DISPATCHER%20CLASS" title="HTTP2/SERVER:TLS-SINGLE-CLIENT-DISPATCHER CLASS">TLS-SINGLE-CLIENT-DISPATCHER</a></span></span></li>
</ul>
<p><a id="x-28HTTP2-2FSERVER-3ADETACHED-TLS-THREADED-DISPATCHER-20CLASS-29"></a>
<a id="HTTP2%2FSERVER:DETACHED-TLS-THREADED-DISPATCHER%20CLASS"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/zellerin/http2/blob/master/server/threaded.lisp#L11">[class]</a></span> <span class="reference-object"><a href="#HTTP2%2FSERVER:DETACHED-TLS-THREADED-DISPATCHER%20CLASS" >DETACHED-TLS-THREADED-DISPATCHER</a></span></span> <span class="locative-args"><a href="#HTTP2%2FSERVER:TLS-THREADED-DISPATCHER%20CLASS" title="HTTP2/SERVER:TLS-THREADED-DISPATCHER CLASS">TLS-THREADED-DISPATCHER</a></span></span></li>
</ul>
<p><a id="x-28HTTP2-2FSERVER-3ATLS-THREADED-DISPATCHER-20CLASS-29"></a>
<a id="HTTP2%2FSERVER:TLS-THREADED-DISPATCHER%20CLASS"></a></p>
<ul>
<li><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/zellerin/http2/blob/master/server/threaded.lisp#L8">[class]</a></span> <span class="reference-object"><a href="#HTTP2%2FSERVER:TLS-THREADED-DISPATCHER%20CLASS" >TLS-THREADED-DISPATCHER</a></span></span> <span class="locative-args">THREADED-DISPATCHER TLS-DISPATCHER-MIXIN</span></span></li>
</ul>
<p><a id="x-28HTTP2-2FSERVER-3APOLL-DISPATCHER-20CLASS-29"></a>
<a id="HTTP2%2FSERVER:POLL-DISPATCHER%20CLASS"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/zellerin/http2/blob/master/server/poll-server.lisp#L727">[class]</a></span> <span class="reference-object"><a href="#HTTP2%2FSERVER:POLL-DISPATCHER%20CLASS" >POLL-DISPATCHER</a></span></span> <span class="locative-args"><a href="#HTTP2%2FSERVER:POLL-DISPATCHER-MIXIN%20CLASS" title="HTTP2/SERVER:POLL-DISPATCHER-MIXIN CLASS">POLL-DISPATCHER-MIXIN</a> TLS-DISPATCHER-MIXIN</span></span></p>

<p>Uses poll to listen to a set of clients and handle arriving packets in a single
thread.</p>

<p>Maximum number of clients is fixed (by default <em>fdset-size</em>, by default
10). Additional clients wait Use <code>:FDSET-SIZE</code> to set a different value.</p></li>
</ul>
<p><a id="x-28HTTP2-2FSERVER-3ADETACHED-POLL-DISPATCHER-20CLASS-29"></a>
<a id="HTTP2%2FSERVER:DETACHED-POLL-DISPATCHER%20CLASS"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/zellerin/http2/blob/master/server/poll-server.lisp#L733">[class]</a></span> <span class="reference-object"><a href="#HTTP2%2FSERVER:DETACHED-POLL-DISPATCHER%20CLASS" >DETACHED-POLL-DISPATCHER</a></span></span> <span class="locative-args"><a href="#HTTP2%2FSERVER:POLL-DISPATCHER%20CLASS" title="HTTP2/SERVER:POLL-DISPATCHER CLASS">POLL-DISPATCHER</a></span></span></p>

<p>Detached version of the <a href="#HTTP2%2FSERVER:POLL-DISPATCHER%20CLASS" title="HTTP2/SERVER:POLL-DISPATCHER CLASS"><code>POLL-DISPATCHER</code></a>.</p></li>
</ul>
<p><a id="x-28HTTP2-2FSERVER-3A-40ASYNC-SERVER-20MGL-PAX-3ASECTION-29"></a>
<a id="HTTP2%2FSERVER:@ASYNC-SERVER%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#HTTP2%2FSERVER:@SERVER-REFERENCE%20MGL-PAX:SECTION" title="Server API reference">&#8592;</a> <a href="reference.html" title="More detailed API documentation">&#8593;</a> <a href="#HTTP2%2FSERVER:@APP-INTERFACE%20MGL-PAX:SECTION" title="Interface to the application">&#8594;</a> <a href="#HTTP2%2FSERVER:@ASYNC-SERVER%20MGL-PAX:SECTION" title="Polling server">&#8634;</a> <a href="https://github.com/zellerin/http2/blob/master/server/poll-server.lisp#L26">&#955;</a></span></span></p>
<h3><a href="#HTTP2%2FSERVER:@ASYNC-SERVER%20MGL-PAX:SECTION">3.2 Polling server</a></h3>
<h6>[in package HTTP2/SERVER with nicknames HTTP2/SERVER/SHARED, HTTP2/SERVER/POLL, HTTP2/SERVER/THREADED]</h6>
<p><a id="x-28HTTP2-2FSERVER-3A-40APP-INTERFACE-20MGL-PAX-3ASECTION-29"></a>
<a id="HTTP2%2FSERVER:@APP-INTERFACE%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#HTTP2%2FSERVER:@ASYNC-SERVER%20MGL-PAX:SECTION" title="Polling server">&#8592;</a> <a href="#HTTP2%2FSERVER:@ASYNC-SERVER%20MGL-PAX:SECTION" title="Polling server">&#8593;</a> <a href="#HTTP2%2FSERVER:@REQUEST-HANDLING%20MGL-PAX:SECTION" title="Client actions loop (implementation)">&#8594;</a> <a href="#HTTP2%2FSERVER:@APP-INTERFACE%20MGL-PAX:SECTION" title="Interface to the application">&#8634;</a> <a href="https://github.com/zellerin/http2/blob/master/server/poll-server.lisp#L32">&#955;</a></span></span></p>
<h4><a href="#HTTP2%2FSERVER:@APP-INTERFACE%20MGL-PAX:SECTION">3.2.1 Interface to the application</a></h4>
<p><a id="x-28HTTP2-2FSERVER-3APOLL-DISPATCHER-MIXIN-20CLASS-29"></a>
<a id="HTTP2%2FSERVER:POLL-DISPATCHER-MIXIN%20CLASS"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/zellerin/http2/blob/master/server/poll-server.lisp#L708">[class]</a></span> <span class="reference-object"><a href="#HTTP2%2FSERVER:POLL-DISPATCHER-MIXIN%20CLASS" >POLL-DISPATCHER-MIXIN</a></span></span></span></p>

<p>Uses poll to listen to a set of clients and handle arriving packets in a single
thread.</p>

<p>Maximum number of clients is fixed (by default <em>fdset-size</em>, by default
10). Additional clients wait until one of existing client leaves.</p>

<p>Timeouts can be specified for polling.</p></li>
</ul>
<p><a id="x-28HTTP2-2FSERVER-3AGET-FDSET-SIZE-20-28MGL-PAX-3AACCESSOR-20HTTP2-2FSERVER-3APOLL-DISPATCHER-MIXIN-29-29"></a>
<a id="HTTP2%2FSERVER:GET-FDSET-SIZE%20%28MGL-PAX:ACCESSOR%20HTTP2%2FSERVER:POLL-DISPATCHER-MIXIN%29"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/zellerin/http2/blob/master/server/poll-server.lisp#L709">[accessor]</a></span> <span class="reference-object"><a href="#HTTP2%2FSERVER:GET-FDSET-SIZE%20%28MGL-PAX:ACCESSOR%20HTTP2%2FSERVER:POLL-DISPATCHER-MIXIN%29" >GET-FDSET-SIZE</a></span></span> <span class="locative-args">POLL-DISPATCHER-MIXIN (:FDSET-SIZE)</span></span></p>

<p>Number of slots for clients to be polled.</p></li>
</ul>
<p><a id="x-28HTTP2-2FSERVER-3AGET-POLL-TIMEOUT-20-28MGL-PAX-3AACCESSOR-20HTTP2-2FSERVER-3APOLL-DISPATCHER-MIXIN-29-29"></a>
<a id="HTTP2%2FSERVER:GET-POLL-TIMEOUT%20%28MGL-PAX:ACCESSOR%20HTTP2%2FSERVER:POLL-DISPATCHER-MIXIN%29"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/zellerin/http2/blob/master/server/poll-server.lisp#L711">[accessor]</a></span> <span class="reference-object"><a href="#HTTP2%2FSERVER:GET-POLL-TIMEOUT%20%28MGL-PAX:ACCESSOR%20HTTP2%2FSERVER:POLL-DISPATCHER-MIXIN%29" >GET-POLL-TIMEOUT</a></span></span> <span class="locative-args">POLL-DISPATCHER-MIXIN (:POLL-TIMEOUT)</span></span></p>

<p>See <a href="#HTTP2%2FSERVER:*POLL-TIMEOUT*%20VARIABLE" title="HTTP2/SERVER:*POLL-TIMEOUT* VARIABLE"><code>*POLL-TIMEOUT*</code></a>.</p></li>
</ul>
<p><a id="x-28HTTP2-2FSERVER-3AGET-NO-CLIENT-POLL-TIMEOUT-20-28MGL-PAX-3AACCESSOR-20HTTP2-2FSERVER-3APOLL-DISPATCHER-MIXIN-29-29"></a>
<a id="HTTP2%2FSERVER:GET-NO-CLIENT-POLL-TIMEOUT%20%28MGL-PAX:ACCESSOR%20HTTP2%2FSERVER:POLL-DISPATCHER-MIXIN%29"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/zellerin/http2/blob/master/server/poll-server.lisp#L713">[accessor]</a></span> <span class="reference-object"><a href="#HTTP2%2FSERVER:GET-NO-CLIENT-POLL-TIMEOUT%20%28MGL-PAX:ACCESSOR%20HTTP2%2FSERVER:POLL-DISPATCHER-MIXIN%29" >GET-NO-CLIENT-POLL-TIMEOUT</a></span></span> <span class="locative-args">POLL-DISPATCHER-MIXIN (:NO-CLIENT-POLL-TIMEOUT)</span></span></p>

<p>See <a href="#HTTP2%2FSERVER:*NO-CLIENT-POLL-TIMEOUT*%20VARIABLE" title="HTTP2/SERVER:*NO-CLIENT-POLL-TIMEOUT* VARIABLE"><code>*NO-CLIENT-POLL-TIMEOUT*</code></a>.</p></li>
</ul>
<p><a id="x-28HTTP2-2FSERVER-3A-2ANO-CLIENT-POLL-TIMEOUT-2A-20VARIABLE-29"></a>
<a id="HTTP2%2FSERVER:*NO-CLIENT-POLL-TIMEOUT*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/zellerin/http2/blob/master/server/poll-server.lisp#L651">[variable]</a></span> <span class="reference-object"><a href="#HTTP2%2FSERVER:*NO-CLIENT-POLL-TIMEOUT*%20VARIABLE" >*NO-CLIENT-POLL-TIMEOUT*</a></span></span> <span class="locative-args">:∞</span></span></p>

<p>Default timeout in seconds to use when there is no client (to limit time to a client to
connect).</p>

<p>This is supposed to be used primarily in the automated tests, where you do not
want indefinite waits in case of a problem.</p>

<p>On timeout signals <a href="#HTTP2%2FSERVER:POLL-TIMEOUT%20CONDITION" title="HTTP2/SERVER:POLL-TIMEOUT CONDITION"><code>POLL-TIMEOUT</code></a> error.</p>

<p>Default means an indefinite wait.</p></li>
</ul>
<p><a id="x-28HTTP2-2FSERVER-3A-2APOLL-TIMEOUT-2A-20VARIABLE-29"></a>
<a id="HTTP2%2FSERVER:*POLL-TIMEOUT*%20VARIABLE"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/zellerin/http2/blob/master/server/poll-server.lisp#L662">[variable]</a></span> <span class="reference-object"><a href="#HTTP2%2FSERVER:*POLL-TIMEOUT*%20VARIABLE" >*POLL-TIMEOUT*</a></span></span> <span class="locative-args">:∞</span></span></p>

<p>Default timeout in seconds to use for poll when there are connected clients,
but no client communication.</p>

<p>On timeout signals <a href="#HTTP2%2FSERVER:POLL-TIMEOUT%20CONDITION" title="HTTP2/SERVER:POLL-TIMEOUT CONDITION"><code>POLL-TIMEOUT</code></a> error.</p>

<p>Default means an indefinite wait.</p></li>
</ul>
<p><a id="x-28HTTP2-2FSERVER-3APOLL-TIMEOUT-20CONDITION-29"></a>
<a id="HTTP2%2FSERVER:POLL-TIMEOUT%20CONDITION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/zellerin/http2/blob/master/server/poll-server.lisp#L645">[condition]</a></span> <span class="reference-object"><a href="#HTTP2%2FSERVER:POLL-TIMEOUT%20CONDITION" >POLL-TIMEOUT</a></span></span> <span class="locative-args"><a href="http://www.lispworks.com/documentation/HyperSpec/Body/e_error.htm" title="ERROR (MGL-PAX:CLHS CONDITION)">ERROR</a></span></span></p>

<p>Poll was called with a timeout and returned before any file descriptor became
ready.</p></li>
</ul>
<p><a id="x-28HTTP2-2FSERVER-3ACOMPUTE-POLL-TIMEOUT-VALUE-20FUNCTION-29"></a>
<a id="HTTP2%2FSERVER:COMPUTE-POLL-TIMEOUT-VALUE%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/zellerin/http2/blob/master/server/poll-server.lisp#L700">[function]</a></span> <span class="reference-object"><a href="#HTTP2%2FSERVER:COMPUTE-POLL-TIMEOUT-VALUE%20FUNCTION" >COMPUTE-POLL-TIMEOUT-VALUE</a></span></span> <span class="locative-args">HUMAN-FORM</span></span></p>

<p>Compute poll timeout from &quot;nice&quot; value (seconds or :∞) to value accepted by
poll (miliseconds or -1)</p></li>
</ul>
<p><a id="x-28HTTP2-2FSERVER-3A-40REQUEST-HANDLING-20MGL-PAX-3ASECTION-29"></a>
<a id="HTTP2%2FSERVER:@REQUEST-HANDLING%20MGL-PAX:SECTION"></a></p>
<p><span class="outer-navigation"><span class="navigation"> <a href="#HTTP2%2FSERVER:@APP-INTERFACE%20MGL-PAX:SECTION" title="Interface to the application">&#8592;</a> <a href="#HTTP2%2FSERVER:@ASYNC-SERVER%20MGL-PAX:SECTION" title="Polling server">&#8593;</a> <a href="#HTTP2%2FSERVER:@REQUEST-HANDLING%20MGL-PAX:SECTION" title="Client actions loop (implementation)">&#8634;</a></span></span></p>
<h4><a href="#HTTP2%2FSERVER:@REQUEST-HANDLING%20MGL-PAX:SECTION">3.2.2 Client actions loop (implementation)</a></h4>
<p>Each client has a <code>STATE</code> that encapsulates what actions are effectively possible.
<a href="#HTTP2%2FSERVER:SELECT-NEXT-ACTION%20FUNCTION" title="HTTP2/SERVER:SELECT-NEXT-ACTION FUNCTION"><code>SELECT-NEXT-ACTION</code></a> selects appropriate action. When no new action is available,
next client is handled and eventually <code>POLL</code> called when all clients were served.</p>
<p>When <code>POLL</code> returns, new action is available for some client (read from a socket or write to it).</p>
<p>The actions are in general indicated by arrows in the diagram:</p>
<p><img src="flow.svg" alt="" /></p>
<p><a id="x-28HTTP2-2FSERVER-3APROCESS-CLIENT-FD-20FUNCTION-29"></a>
<a id="HTTP2%2FSERVER:PROCESS-CLIENT-FD%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/zellerin/http2/blob/master/server/poll-server.lisp#L513">[function]</a></span> <span class="reference-object"><a href="#HTTP2%2FSERVER:PROCESS-CLIENT-FD%20FUNCTION" >PROCESS-CLIENT-FD</a></span></span> <span class="locative-args">FD-PTR CLIENT</span></span></p>

<p>Process events available on <code>FD-PTR</code> (a pointer to struct pollfd) with <code>CLIENT</code>.</p>

<p>The new possible action corresponding to ① or ⑥ on the diagram above is added to the client state and <a href="#HTTP2%2FSERVER:DO-AVAILABLE-ACTIONS%20FUNCTION" title="HTTP2/SERVER:DO-AVAILABLE-ACTIONS FUNCTION"><code>DO-AVAILABLE-ACTIONS</code></a> is called to react to that.</p></li>
</ul>
<p><a id="x-28HTTP2-2FSERVER-3ADO-AVAILABLE-ACTIONS-20FUNCTION-29"></a>
<a id="HTTP2%2FSERVER:DO-AVAILABLE-ACTIONS%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/zellerin/http2/blob/master/server/poll-server.lisp#L370">[function]</a></span> <span class="reference-object"><a href="#HTTP2%2FSERVER:DO-AVAILABLE-ACTIONS%20FUNCTION" >DO-AVAILABLE-ACTIONS</a></span></span> <span class="locative-args">CLIENT</span></span></p>

<p>Run available actions as selected by <a href="#HTTP2%2FSERVER:SELECT-NEXT-ACTION%20FUNCTION" title="HTTP2/SERVER:SELECT-NEXT-ACTION FUNCTION"><code>SELECT-NEXT-ACTION</code></a> till there is none.</p></li>
</ul>
<p><a id="x-28HTTP2-2FSERVER-3ASELECT-NEXT-ACTION-20FUNCTION-29"></a>
<a id="HTTP2%2FSERVER:SELECT-NEXT-ACTION%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/zellerin/http2/blob/master/server/poll-server.lisp#L346">[function]</a></span> <span class="reference-object"><a href="#HTTP2%2FSERVER:SELECT-NEXT-ACTION%20FUNCTION" >SELECT-NEXT-ACTION</a></span></span> <span class="locative-args">CLIENT</span></span></p>

<p>One of possible next actions consistent with then the state of the client, or
nil if no action is available.</p>

<p>This is factored out so that it can be traced. There is a
TLS-SERVER/MEASURE::ACTIONS clip on this function.</p></li>
</ul>
<p><a id="x-28HTTP2-2FSERVER-3APROCESS-DATA-ON-SOCKET-20FUNCTION-29"></a>
<a id="HTTP2%2FSERVER:PROCESS-DATA-ON-SOCKET%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/zellerin/http2/blob/master/server/poll-server.lisp#L211">[function]</a></span> <span class="reference-object"><a href="#HTTP2%2FSERVER:PROCESS-DATA-ON-SOCKET%20FUNCTION" >PROCESS-DATA-ON-SOCKET</a></span></span> <span class="locative-args">CLIENT</span></span></p>

<p>Read data from client socket ① and pass them to the tls buffer ② to decrypt.</p></li>
</ul>
<p><a id="x-28HTTP2-2FSERVER-3AENCRYPT-DATA-20FUNCTION-29"></a>
<a id="HTTP2%2FSERVER:ENCRYPT-DATA%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/zellerin/http2/blob/master/server/poll-server.lisp#L262">[function]</a></span> <span class="reference-object"><a href="#HTTP2%2FSERVER:ENCRYPT-DATA%20FUNCTION" >ENCRYPT-DATA</a></span></span> <span class="locative-args">CLIENT</span></span></p>

<p>Encrypt data in client's <code>ENCRYPT-BUF</code>.</p>

<p>Do nothing if there is no data to encrypt or <code>SSL</code> not yet initialized (and return zero).</p>

<p>Otherwise, use a temporary vector to write data </p></li>
</ul>
<p><a id="x-28HTTP2-2FSERVER-3AMOVE-ENCRYPTED-BYTES-20FUNCTION-29"></a>
<a id="HTTP2%2FSERVER:MOVE-ENCRYPTED-BYTES%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/zellerin/http2/blob/master/server/poll-server.lisp#L291">[function]</a></span> <span class="reference-object"><a href="#HTTP2%2FSERVER:MOVE-ENCRYPTED-BYTES%20FUNCTION" >MOVE-ENCRYPTED-BYTES</a></span></span> <span class="locative-args">CLIENT</span></span></p>

<p>Move data encrypted by OpenSSL to the socket write queue Ⓔ.</p>

<p>This should be called in a way friendly to Nagle algorithm. My understaning is
this is either when we pipeline a lot of data, or when we send out somethinf
that expects a response.</p></li>
</ul>
<p><a id="x-28HTTP2-2FSERVER-3AWRITE-DATA-TO-SOCKET-20FUNCTION-29"></a>
<a id="HTTP2%2FSERVER:WRITE-DATA-TO-SOCKET%20FUNCTION"></a></p>
<ul>
<li><p><span class=reference-bullet><span class=reference><span class="locative-type"><a href="https://github.com/zellerin/http2/blob/master/server/poll-server.lisp#L318">[function]</a></span> <span class="reference-object"><a href="#HTTP2%2FSERVER:WRITE-DATA-TO-SOCKET%20FUNCTION" >WRITE-DATA-TO-SOCKET</a></span></span> <span class="locative-args">CLIENT</span></span></p>

<p>Write buffered encrypted data Ⓔ to the client socket ⑥. Update the write buffer to
keep what did not fit.</p></li>
</ul>
  </div>
</div>
<script>$('#page-toc').toc({'selectors': 'h1,h2,h3,h4'});</script>
</body>
</html>
